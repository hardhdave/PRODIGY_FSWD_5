{% extends "base.html" %} {% block title %}{% if query %}Search: {{ query }}{%
else %}Search{% endif %} - SocialApp{% endblock %} {% block content %}
<div class="content-grid">
  <!-- Left Sidebar -->
  <aside class="sidebar">
    <h3>Search Filters</h3>
    <ul>
      <li>
        <a
          href="{{ url_for('main.search', q=query) }}"
          class="{{ 'active' if not request.args.get('type') }}"
        >
          <i class="fas fa-search"></i> All Results
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('main.search', q=query, type='posts') }}"
          class="{{ 'active' if request.args.get('type') == 'posts' }}"
        >
          <i class="fas fa-file-alt"></i> Posts
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('main.search', q=query, type='users') }}"
          class="{{ 'active' if request.args.get('type') == 'users' }}"
        >
          <i class="fas fa-users"></i> Users
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('main.search', q=query, type='tags') }}"
          class="{{ 'active' if request.args.get('type') == 'tags' }}"
        >
          <i class="fas fa-hashtag"></i> Tags
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('main.search', q=query, type='photos') }}"
          class="{{ 'active' if request.args.get('type') == 'photos' }}"
        >
          <i class="fas fa-image"></i> Photos
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('main.search', q=query, type='videos') }}"
          class="{{ 'active' if request.args.get('type') == 'videos' }}"
        >
          <i class="fas fa-video"></i> Videos
        </a>
      </li>
    </ul>
  </aside>

  <!-- Main Content -->
  <div class="feed">
    <div
      class="search-header"
      style="padding: 2rem; border-bottom: 1px solid #eee"
    >
      {% if query %}
      <h2><i class="fas fa-search"></i> Search Results for "{{ query }}"</h2>
      <p class="text-muted">
        Found {{ posts.total if posts else 0 }} posts and {{ users|length if
        users else 0 }} users
      </p>
      {% else %}
      <h2><i class="fas fa-search"></i> Search</h2>
      <p class="text-muted">
        Enter a search term to find posts, users, and content
      </p>
      {% endif %}
    </div>

    <!-- Search Form -->
    <div
      class="search-form-container"
      style="
        padding: 1.5rem 2rem;
        background: #f8f9fa;
        border-bottom: 1px solid #eee;
      "
    >
      <form
        action="{{ url_for('main.search') }}"
        method="GET"
        class="d-flex gap-2"
      >
        <input
          type="text"
          name="q"
          class="form-input"
          style="flex: 1"
          placeholder="Search posts, users, tags..."
          value="{{ query or '' }}"
          autofocus
        />
        <input
          type="hidden"
          name="type"
          value="{{ request.args.get('type', '') }}"
        />
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-search"></i> Search
        </button>
      </form>
    </div>

    {% if query %}
    <!-- Users Results -->
    {% if users and (not request.args.get('type') or request.args.get('type') ==
    'users') %}
    <div class="search-section" style="padding: 2rem">
      <h3 style="margin-bottom: 1.5rem; color: #333">
        <i class="fas fa-users"></i> Users ({{ users|length }})
      </h3>

      {% if users %}
      <div class="users-grid" style="display: grid; gap: 1rem">
        {% for user in users %}
        <div
          class="user-result"
          style="
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
          "
        >
          <img
            src="{{ user.get_profile_picture_url() }}"
            alt="{{ user.username }}"
            style="
              width: 60px;
              height: 60px;
              border-radius: 50%;
              object-fit: cover;
            "
          />
          <div style="flex: 1">
            <div
              style="
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 0.3rem;
              "
            >
              <a
                href="{{ url_for('user.profile', username=user.username) }}"
                style="
                  font-weight: 600;
                  color: #333;
                  text-decoration: none;
                  font-size: 1.1rem;
                "
              >
                {{ user.full_name or user.username }}
              </a>
              {% if user.is_verified %}
              <i
                class="fas fa-check-circle"
                style="color: #007bff; font-size: 0.9rem"
              ></i>
              {% endif %}
            </div>
            <div style="color: #666; font-size: 0.9rem; margin-bottom: 0.3rem">
              @{{ user.username }}
            </div>
            {% if user.bio %}
            <div style="color: #888; font-size: 0.85rem; line-height: 1.4">
              {{ user.bio[:100] }}{% if user.bio|length > 100 %}...{% endif %}
            </div>
            {% endif %}
            <div style="color: #999; font-size: 0.8rem; margin-top: 0.5rem">
              {{ user.posts_count() }} posts â€¢ {{ user.followers_count() }}
              followers
            </div>
          </div>
          {% if current_user.is_authenticated and current_user != user %} {% if
          current_user.is_following(user) %}
          <button
            class="btn btn-secondary"
            onclick="unfollowUser('{{ user.username }}')"
          >
            Following
          </button>
          {% else %}
          <button
            class="btn btn-outline"
            onclick="followUser('{{ user.username }}')"
          >
            Follow
          </button>
          {% endif %} {% endif %}
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted" style="text-align: center; padding: 2rem">
        No users found.
      </p>
      {% endif %}
    </div>
    {% endif %}

    <!-- Posts Results -->
    {% if posts and (not request.args.get('type') or request.args.get('type') ==
    'posts') %}
    <div class="search-section">
      {% if not request.args.get('type') or request.args.get('type') == 'posts'
      %}
      <div style="padding: 0 2rem">
        <h3 style="margin-bottom: 1.5rem; color: #333">
          <i class="fas fa-file-alt"></i> Posts ({{ posts.total }})
        </h3>
      </div>
      {% endif %} {% if posts.items %} {% for post in posts.items %} {% include
      'post/components/post_card.html' %} {% endfor %}

      <!-- Pagination -->
      {% if posts.pages > 1 %}
      <div class="pagination">
        {% if posts.has_prev %}
        <a
          href="{{ url_for('main.search', q=query, page=posts.prev_num, **request.args) }}"
          class="page-link"
          >Previous</a
        >
        {% endif %} {% for page_num in posts.iter_pages() %} {% if page_num %}
        {% if page_num != posts.page %}
        <a
          href="{{ url_for('main.search', q=query, page=page_num, **request.args) }}"
          class="page-link"
          >{{ page_num }}</a
        >
        {% else %}
        <span class="page-link active">{{ page_num }}</span>
        {% endif %} {% endif %} {% endfor %} {% if posts.has_next %}
        <a
          href="{{ url_for('main.search', q=query, page=posts.next_num, **request.args) }}"
          class="page-link"
          >Next</a
        >
        {% endif %}
      </div>
      {% endif %} {% else %}
      <p class="text-muted" style="text-align: center; padding: 2rem">
        No posts found.
      </p>
      {% endif %}
    </div>
    {% endif %}

    <!-- No Results -->
    {% if (not posts or not posts.items) and (not users or not users) %}
    <div class="no-results" style="text-align: center; padding: 4rem 2rem">
      <i
        class="fas fa-search"
        style="font-size: 4rem; color: #ccc; margin-bottom: 1rem"
      ></i>
      <h3 style="color: #666; margin-bottom: 1rem">
        No results found for "{{ query }}"
      </h3>
      <p class="text-muted" style="margin-bottom: 2rem">
        Try adjusting your search terms or explore different categories.
      </p>
      <div
        class="search-suggestions"
        style="
          display: flex;
          gap: 1rem;
          justify-content: center;
          flex-wrap: wrap;
        "
      >
        <a href="{{ url_for('main.explore') }}" class="btn btn-outline">
          <i class="fas fa-compass"></i> Explore Trending
        </a>
        <a href="{{ url_for('main.index') }}" class="btn btn-outline">
          <i class="fas fa-home"></i> Back to Home
        </a>
      </div>
    </div>
    {% endif %} {% else %}
    <!-- Search Tips -->
    <div class="search-tips" style="padding: 3rem 2rem; text-align: center">
      <i
        class="fas fa-lightbulb"
        style="font-size: 3rem; color: #ffc107; margin-bottom: 1.5rem"
      ></i>
      <h3 style="margin-bottom: 1.5rem">Search Tips</h3>
      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 2rem;
          margin-top: 2rem;
        "
      >
        <div
          class="tip-card"
          style="
            background: #fff;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          "
        >
          <i
            class="fas fa-hashtag"
            style="color: #007bff; font-size: 2rem; margin-bottom: 1rem"
          ></i>
          <h4>Use Hashtags</h4>
          <p class="text-muted">
            Search with #hashtags to find related content and trending topics.
          </p>
        </div>
        <div
          class="tip-card"
          style="
            background: #fff;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          "
        >
          <i
            class="fas fa-at"
            style="color: #28a745; font-size: 2rem; margin-bottom: 1rem"
          ></i>
          <h4>Find Users</h4>
          <p class="text-muted">
            Use @username or search by name to find specific users.
          </p>
        </div>
        <div
          class="tip-card"
          style="
            background: #fff;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          "
        >
          <i
            class="fas fa-quote-left"
            style="color: #6f42c1; font-size: 2rem; margin-bottom: 1rem"
          ></i>
          <h4>Search Content</h4>
          <p class="text-muted">
            Search for keywords in posts to find relevant discussions.
          </p>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Right Sidebar -->
  <aside class="right-sidebar">
    <!-- Recent Searches -->
    <div class="widget">
      <h3><i class="fas fa-clock"></i> Recent Searches</h3>
      <div class="recent-searches">
        <a
          href="{{ url_for('main.search', q='technology') }}"
          class="recent-search-item"
        >
          <i class="fas fa-search"></i> technology
        </a>
        <a
          href="{{ url_for('main.search', q='travel') }}"
          class="recent-search-item"
        >
          <i class="fas fa-search"></i> travel
        </a>
        <a
          href="{{ url_for('main.search', q='food') }}"
          class="recent-search-item"
        >
          <i class="fas fa-search"></i> food
        </a>
      </div>
    </div>

    <!-- Popular Tags -->
    <div class="widget">
      <h3><i class="fas fa-fire"></i> Popular Tags</h3>
      <div
        class="popular-tags"
        style="display: flex; flex-wrap: wrap; gap: 0.5rem"
      >
        <a href="{{ url_for('main.search', q='photography') }}" class="tag"
          >#photography</a
        >
        <a href="{{ url_for('main.search', q='travel') }}" class="tag"
          >#travel</a
        >
        <a href="{{ url_for('main.search', q='food') }}" class="tag">#food</a>
        <a href="{{ url_for('main.search', q='tech') }}" class="tag">#tech</a>
        <a href="{{ url_for('main.search', q='art') }}" class="tag">#art</a>
        <a href="{{ url_for('main.search', q='music') }}" class="tag">#music</a>
      </div>
    </div>
  </aside>
</div>

<style>
  .recent-search-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
    color: #666;
    text-decoration: none;
    border-bottom: 1px solid #f0f0f0;
    transition: color 0.3s;
  }

  .recent-search-item:hover {
    color: #007bff;
  }

  .recent-search-item:last-child {
    border-bottom: none;
  }

  .search-section {
    border-bottom: 1px solid #eee;
  }

  .search-section:last-child {
    border-bottom: none;
  }
</style>
{% endblock %}
